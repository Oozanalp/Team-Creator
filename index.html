<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1EGIT Gaming - Team Creator</title>
    <!-- Firebase SDK - Uncomment when you have Firebase config -->
     <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script> 
     <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script> 
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #313338 !important;
            min-height: 100vh;
            padding: 20px;
        }

        .page-wrapper {
            display: flex !important;
            flex-direction: row !important;
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
            align-items: flex-start;
        }

        .main-container {
            flex: 1 1 auto;
            min-width: 0;
            max-width: calc(100% - 320px);
        }

        .container {
            background: #2b2d31 !important;
            border-radius: 8px;
            padding: 32px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.24);
            position: relative;
        }

        .server-info {
            position: absolute;
            top: 16px;
            right: 16px;
            text-align: right;
            font-family: 'Consolas', 'Monaco', monospace;
        }

        .server-info .connect {
            color: #3ba55c;
            font-size: 13px;
            font-weight: 600;
        }

        .server-info .password {
            color: #faa61a;
            font-size: 12px;
            margin-top: 2px;
        }

        .header {
            text-align: center;
            margin-bottom: 24px;
        }

        .logo {
            width: 140px;
            height: auto;
            margin-bottom: 12px;
        }

        h1 {
            text-align: center;
            color: #ffffff;
            margin-bottom: 8px;
            font-size: 1.8em;
            font-weight: 600;
        }

        .input-section {
            background: #232428 !important;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #b5bac1;
            font-size: 0.875em;
            text-transform: uppercase;
            letter-spacing: 0.02em;
        }

        .add-player-form {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            flex-wrap: wrap;
            align-items: flex-end;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .form-group.name-group {
            flex: 2;
            min-width: 180px;
        }

        .form-group.rank-group {
            flex: 1.5;
            min-width: 160px;
        }

        .form-group label {
            font-size: 0.75em;
            margin-bottom: 0;
        }

        input[type="text"] {
            padding: 10px 12px;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            background: #1e1f22;
            color: #dbdee1;
            transition: all 0.2s;
        }

        input[type="text"]:focus {
            outline: none;
            box-shadow: 0 0 0 2px #5865f2;
        }

        input[type="text"]::placeholder {
            color: #6d6f78;
        }

        select {
            padding: 10px 12px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            background: #1e1f22;
            color: #dbdee1;
            transition: all 0.2s;
            cursor: pointer;
        }

        select:focus {
            outline: none;
            box-shadow: 0 0 0 2px #5865f2;
        }

        .btn-add {
            padding: 10px 20px;
            background: #5865f2 !important;
            color: white !important;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            height: 40px;
        }

        .btn-add:hover {
            background: #4752c4 !important;
        }

        .players-list {
            margin-top: 20px;
            margin-bottom: 16px;
        }

        .players-list h3 {
            color: #ffffff;
            margin-bottom: 12px;
            font-size: 1em;
            font-weight: 600;
        }

        #playersContainer {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 8px;
            max-height: 350px;
            overflow-y: auto;
            padding: 8px;
            background: #1e1f22;
            border-radius: 4px;
        }

        #playersContainer::-webkit-scrollbar {
            width: 8px;
        }

        #playersContainer::-webkit-scrollbar-track {
            background: #1e1f22;
            border-radius: 4px;
        }

        #playersContainer::-webkit-scrollbar-thumb {
            background: #404249;
            border-radius: 4px;
        }

        .player-card {
            background: #2b2d31;
            padding: 10px 12px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
            transition: background 0.2s;
        }

        .player-card:hover {
            background: #35373c;
        }

        .player-info {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }

        .player-name {
            color: #dbdee1;
            font-weight: 500;
            font-size: 14px;
        }

        .rank-select-inline {
            padding: 4px 8px;
            border: none;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .rank-select-inline:focus {
            outline: none;
            box-shadow: 0 0 0 2px #5865f2;
        }

        .rank-select-inline.silver, .rank-badge.silver { background: #6d6f78; color: white; }
        .rank-select-inline.gold, .rank-badge.gold { background: #f0b232; color: #1e1f22; }
        .rank-select-inline.master, .rank-badge.master { background: #3ba55c; color: white; }
        .rank-select-inline.elite, .rank-badge.elite { background: #5865f2; color: white; }
        .rank-select-inline.global, .rank-badge.global { background: #faa61a; color: #1e1f22; }

        .rank-badge {
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            white-space: nowrap;
        }

        .btn-delete {
            background: transparent;
            border: none;
            color: #ed4245;
            cursor: pointer;
            font-size: 16px;
            padding: 4px;
            transition: all 0.2s;
            width: 28px;
            height: 28px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-delete:hover {
            background: rgba(237, 66, 69, 0.1);
        }

        .empty-state {
            text-align: center;
            padding: 32px;
            color: #6d6f78;
            font-size: 14px;
        }

        .settings {
            display: flex;
            gap: 16px;
            margin-top: 16px;
            flex-wrap: wrap;
        }

        .setting-group {
            flex: 1;
            min-width: 180px;
        }

        input[type="number"] {
            width: 100%;
            padding: 10px 12px;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            background: #1e1f22;
            color: #dbdee1;
            transition: all 0.2s;
        }

        input[type="number"]:focus {
            outline: none;
            box-shadow: 0 0 0 2px #5865f2;
        }

        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        button {
            flex: 1;
            padding: 12px 24px;
            font-size: 14px;
            font-weight: 500;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            min-width: 140px;
        }

        .btn-primary {
            background: #5865f2 !important;
            color: white !important;
        }

        .btn-primary:hover {
            background: #4752c4 !important;
        }

        .btn-secondary {
            background: transparent !important;
            color: #ed4245 !important;
            border: 1px solid #ed4245 !important;
        }

        .btn-secondary:hover {
            background: rgba(237, 66, 69, 0.1) !important;
        }

        .results {
            margin-top: 24px;
            display: none;
        }

        .results.active {
            display: block;
        }

        .results > h2 {
            color: #ffffff;
            margin-bottom: 16px;
            font-size: 1.1em;
            font-weight: 600;
        }

        .teams-wrapper {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }

        .team {
            flex: 1;
            min-width: 280px;
            background: #232428;
            padding: 16px;
            border-radius: 8px;
        }

        .team.terrorists {
            border-left: 4px solid #f0b232;
        }

        .team.counter-terrorists {
            border-left: 4px solid #5865f2;
        }

        .team h2 {
            color: #ffffff;
            margin-bottom: 12px;
            font-size: 1em;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 8px;
        }

        .team.terrorists h2 { color: #f0b232; }
        .team.counter-terrorists h2 { color: #5865f2; }

        .team-power {
            font-size: 0.85em;
            color: #b5bac1;
            background: #1e1f22;
            padding: 4px 12px;
            border-radius: 4px;
        }

        .team ul {
            list-style: none;
        }

        .team li {
            padding: 8px 12px;
            background: #1e1f22;
            margin-bottom: 6px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            color: #dbdee1;
            cursor: pointer;
            transition: all 0.2s;
        }

        .team li:hover {
            background: #2b2d31;
        }

        .team li.selected-for-swap {
            background: #5865f2;
            box-shadow: 0 0 0 2px #ffffff;
        }

        .team li:last-child {
            margin-bottom: 0;
        }

        .player-number {
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 12px;
        }

        .team.terrorists .player-number { background: #f0b232; color: #1e1f22; }
        .team.counter-terrorists .player-number { background: #5865f2; }

        .swap-info {
            text-align: center;
            padding: 12px;
            background: #1e1f22;
            border-radius: 4px;
            margin-bottom: 16px;
            color: #b5bac1;
            font-size: 13px;
        }

        .swap-info.active {
            background: #5865f2;
            color: white;
        }

        .error {
            background: rgba(237, 66, 69, 0.1);
            border-left: 4px solid #ed4245;
            padding: 12px 16px;
            margin-top: 12px;
            border-radius: 4px;
            color: #ed4245;
            font-size: 14px;
            display: none;
        }

        .error.active {
            display: block;
        }

        .copy-btn {
            background: #5865f2 !important;
            color: white !important;
            padding: 10px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 12px;
            font-size: 14px;
            font-weight: 500;
        }

        .copy-btn:hover {
            background: #4752c4 !important;
        }

        /* BENCH PANEL - RIGHT SIDE */
        .bench-panel {
            width: 300px;
            flex-shrink: 0;
            background: #2b2d31;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.24);
            position: sticky;
            top: 20px;
            max-height: calc(100vh - 40px);
            display: flex;
            flex-direction: column;
        }

        .bench-panel h3 {
            color: #ffffff;
            margin-bottom: 16px;
            font-size: 1em;
            font-weight: 600;
        }

        .bench-add-form {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .bench-add-form input {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            background: #1e1f22;
            color: #dbdee1;
        }

        .bench-add-form input:focus {
            outline: none;
            box-shadow: 0 0 0 2px #5865f2;
        }

        .bench-add-form button {
            padding: 8px 12px;
            min-width: auto;
            flex: none;
        }

        .bench-actions {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .bench-actions button {
            flex: 1;
            padding: 8px 12px;
            font-size: 12px;
            min-width: auto;
        }

        .btn-green {
            background: #3ba55c !important;
            color: white !important;
            border: none !important;
        }

        .btn-green:hover {
            background: #2d8049 !important;
        }

        .bench-list {
            flex: 1;
            overflow-y: auto;
            min-height: 200px;
        }

        .bench-list::-webkit-scrollbar {
            width: 6px;
        }

        .bench-list::-webkit-scrollbar-track {
            background: #1e1f22;
            border-radius: 4px;
        }

        .bench-list::-webkit-scrollbar-thumb {
            background: #404249;
            border-radius: 4px;
        }

        .bench-item {
            display: flex;
            align-items: center;
            padding: 8px 10px;
            background: #1e1f22;
            border-radius: 4px;
            margin-bottom: 6px;
            gap: 8px;
        }

        .bench-item:hover {
            background: #35373c;
        }

        .bench-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #5865f2;
        }

        .bench-item-info {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
            min-width: 0;
        }

        .bench-item-name {
            color: #dbdee1;
            font-size: 13px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .bench-item-actions {
            display: flex;
            gap: 4px;
            flex-shrink: 0;
        }

        .btn-bench-remove {
            background: transparent;
            color: #ed4245;
            border: none;
            padding: 4px 6px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            min-width: auto;
            flex: none;
        }

        .btn-bench-remove:hover {
            background: rgba(237, 66, 69, 0.1);
        }

        .shuffle-info {
            font-size: 11px;
            color: #6d6f78;
            margin-top: 8px;
            font-style: italic;
        }

        .selected-count {
            font-size: 12px;
            color: #3ba55c;
            margin-bottom: 8px;
        }

        @media (max-width: 900px) {
            .page-wrapper {
                flex-direction: column;
            }
            .bench-panel {
                width: 100%;
                position: static;
                max-height: none;
            }
            .bench-list {
                max-height: 300px;
            }
        }

        @media (max-width: 768px) {
            .container { padding: 16px; }
            h1 { font-size: 1.5em; }
            .settings, .button-group, .add-player-form { flex-direction: column; }
            button, .form-group { width: 100%; }
            .server-info {
                position: static;
                text-align: center;
                margin-bottom: 16px;
            }
            .teams-wrapper {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="page-wrapper">
        <div class="main-container">
            <div class="container">
                <div class="server-info">
                    <div class="connect">Connect 95.173.175.173</div>
                    <div class="password">Password 3113</div>
                </div>

                <div class="header">
                    <img src="https://raw.githubusercontent.com/Oozanalp/Team-Creator/main/guncel_1egit%202.png" alt="1EGIT Gaming Logo" class="logo">
                    <h1>Team Creator</h1>
                </div>

                <div class="input-section">
                    <label>üéÆ Add New Player</label>
                    <div class="add-player-form">
                        <div class="form-group name-group">
                            <label for="playerName">Name</label>
                            <input type="text" id="playerName" placeholder="Player name...">
                        </div>
                        <div class="form-group rank-group">
                            <label for="playerRank">CS2 Rank</label>
                            <select id="playerRank">
                                <optgroup label="Silver">
                                    <option value="1">Silver I</option>
                                    <option value="2">Silver II</option>
                                    <option value="3">Silver III</option>
                                    <option value="4">Silver IV</option>
                                    <option value="5">Silver Elite</option>
                                    <option value="6">Silver Elite Master</option>
                                </optgroup>
                                <optgroup label="Gold Nova">
                                    <option value="7">Gold Nova I</option>
                                    <option value="8">Gold Nova II</option>
                                    <option value="9" selected>Gold Nova III</option>
                                    <option value="10">Gold Nova Master</option>
                                </optgroup>
                                <optgroup label="Master Guardian">
                                    <option value="11">Master Guardian I</option>
                                    <option value="12">Master Guardian II</option>
                                    <option value="13">Master Guardian Elite</option>
                                    <option value="14">Distinguished Master Guardian</option>
                                </optgroup>
                                <optgroup label="Elite">
                                    <option value="15">Legendary Eagle</option>
                                    <option value="16">Legendary Eagle Master</option>
                                    <option value="17">Supreme Master First Class</option>
                                    <option value="18">Global Elite</option>
                                </optgroup>
                            </select>
                        </div>
                        <button class="btn-add" onclick="addPlayer()">+ Add</button>
                    </div>

                    <div class="players-list">
                        <h3>üìã Active Players (<span id="playerCount">0</span>)</h3>
                        <div id="playersContainer"></div>
                    </div>

                    <div class="settings">
                        <div class="setting-group">
                            <label for="teamCount">Number of Teams</label>
                            <input type="number" id="teamCount" min="2" max="20" value="2">
                        </div>
                        <div class="setting-group">
                            <label for="playersPerTeam">Players per Team (0 = Auto)</label>
                            <input type="number" id="playersPerTeam" min="0" max="50" value="5">
                        </div>
                    </div>

                    <div class="error" id="error"></div>

                    <div class="button-group">
                        <button class="btn-primary" onclick="createTeams()">üé≤ Create Balanced Teams</button>
                        <button class="btn-secondary" onclick="clearAllPlayers()">üóëÔ∏è Clear Active Players</button>
                    </div>
                    <div class="shuffle-info">üí° Press multiple times to shuffle. Click players in teams to swap them.</div>
                </div>

                <div class="results" id="results">
                    <h2>üìã Generated Teams</h2>
                    <div class="swap-info" id="swapInfo">Click a player to select, then click another to swap</div>
                    <div class="teams-wrapper" id="teamsContainer"></div>
                    <button class="copy-btn" onclick="copyResults()">üìã Copy Results</button>
                </div>
            </div>
        </div>

        <!-- BENCH PANEL - RIGHT SIDE -->
        <div class="bench-panel">
            <h3>ü™ë Bench</h3>
            <div class="bench-add-form">
                <input type="text" id="benchName" placeholder="Add to bench...">
                <button class="btn-add" onclick="addToBench()">+</button>
            </div>
            <div class="bench-actions">
                <button class="btn-green" onclick="addSelectedToActive()">Add Selected</button>
                <button class="btn-secondary" onclick="selectAllBench()">Select All</button>
            </div>
            <div class="selected-count" id="selectedCount"></div>
            <div class="bench-list" id="benchList"></div>
        </div>
    </div>

    <script>
        /*
        =============================================
        FIREBASE SETUP GUIDE
        =============================================
        
        1. Go to https://console.firebase.google.com/
        2. Click "Create a project" or "Add project"
        3. Enter project name: "team-creator-1egit"
        4. Disable Google Analytics (not needed)
        5. Click "Create project"
        
        6. In the project dashboard, click "Realtime Database" in left menu
        7. Click "Create Database"
        8. Choose location (europe-west1 recommended)
        9. Start in "Test mode" (allows read/write for 30 days)
        10. Click "Enable"
        
        11. Go to Project Settings (gear icon) > General
        12. Scroll down to "Your apps" > Click web icon (</>)
        13. Register app with nickname "team-creator"
        14. Copy the firebaseConfig object
        
        15. Uncomment the Firebase SDK scripts at top of this file
        16. Replace the firebaseConfig below with your config
        17. Set useFirebase = true
        
        18. IMPORTANT: Update database rules for production:
            Go to Realtime Database > Rules and set:
            {
              "rules": {
                ".read": true,
                ".write": true
              }
            }
        
        =============================================
        */

        // FIREBASE CONFIG - Replace with your config
        const firebaseConfig = {
  apiKey: "AIzaSyC_BDlbY-uyUOKguX9q0NvgMMaNlpJEvRU",
  authDomain: "legit---team-creator.firebaseapp.com",
  databaseURL: "https://legit---team-creator-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "legit---team-creator",
  storageBucket: "legit---team-creator.firebasestorage.app",
  messagingSenderId: "475101153038",
  appId: "1:475101153038:web:a6a464384178890d60f95f"
        };

        // Set to true after configuring Firebase
        const useFirebase = true;
        let db = null;

        // Initialize Firebase if enabled
        if (useFirebase && typeof firebase !== 'undefined') {
            try {
                firebase.initializeApp(firebaseConfig);
                db = firebase.database();
                console.log('Firebase initialized');
            } catch (e) {
                console.log('Firebase init error:', e);
            }
        }

        const CS2_RANKS = {
            1: { name: 'Silver I', short: 'S1', tier: 'silver' },
            2: { name: 'Silver II', short: 'S2', tier: 'silver' },
            3: { name: 'Silver III', short: 'S3', tier: 'silver' },
            4: { name: 'Silver IV', short: 'S4', tier: 'silver' },
            5: { name: 'Silver Elite', short: 'SE', tier: 'silver' },
            6: { name: 'Silver Elite Master', short: 'SEM', tier: 'silver' },
            7: { name: 'Gold Nova I', short: 'GN1', tier: 'gold' },
            8: { name: 'Gold Nova II', short: 'GN2', tier: 'gold' },
            9: { name: 'Gold Nova III', short: 'GN3', tier: 'gold' },
            10: { name: 'Gold Nova Master', short: 'GNM', tier: 'gold' },
            11: { name: 'Master Guardian I', short: 'MG1', tier: 'master' },
            12: { name: 'Master Guardian II', short: 'MG2', tier: 'master' },
            13: { name: 'Master Guardian Elite', short: 'MGE', tier: 'master' },
            14: { name: 'Distinguished Master Guardian', short: 'DMG', tier: 'master' },
            15: { name: 'Legendary Eagle', short: 'LE', tier: 'elite' },
            16: { name: 'Legendary Eagle Master', short: 'LEM', tier: 'elite' },
            17: { name: 'Supreme Master First Class', short: 'SMFC', tier: 'elite' },
            18: { name: 'Global Elite', short: 'GE', tier: 'global' }
        };

        let players = [];
        let bench = [];
        let currentTeams = [];
        let shuffleCount = 0;
        let selectedForSwap = null; // {teamIndex, playerIndex}

        // Initialize
        window.onload = function() {
            loadData();
        };

        function loadData() {
            if (useFirebase && db) {
                db.ref('players').on('value', (snapshot) => {
                    players = [];
                    snapshot.forEach((child) => {
                        players.push({ id: child.key, ...child.val() });
                    });
                    renderPlayers();
                });
                db.ref('bench').on('value', (snapshot) => {
                    bench = [];
                    snapshot.forEach((child) => {
                        bench.push({ id: child.key, ...child.val() });
                    });
                    renderBench();
                });
            } else {
                players = JSON.parse(localStorage.getItem('players_1egit')) || [];
                bench = JSON.parse(localStorage.getItem('bench_1egit')) || [];
                renderPlayers();
                renderBench();
            }
        }

        function savePlayers() {
            if (useFirebase && db) {
                const obj = {};
                players.forEach((p, i) => { obj[p.id || i] = { name: p.name, rank: p.rank }; });
                db.ref('players').set(obj);
            } else {
                localStorage.setItem('players_1egit', JSON.stringify(players));
            }
        }

        function saveBench() {
            if (useFirebase && db) {
                const obj = {};
                bench.forEach((b, i) => { obj[b.id || i] = { name: b.name, rank: b.rank }; });
                db.ref('bench').set(obj);
            } else {
                localStorage.setItem('bench_1egit', JSON.stringify(bench));
            }
        }

        function addPlayer() {
            const nameInput = document.getElementById('playerName');
            const rankSelect = document.getElementById('playerRank');
            const name = nameInput.value.trim();
            const rank = parseInt(rankSelect.value);

            if (!name) { showError('Please enter a player name!'); return; }
            if (players.some(p => p.name.toLowerCase() === name.toLowerCase())) {
                showError('This player is already active!'); return;
            }

            players.push({ name, rank, id: Date.now().toString() });
            savePlayers();
            renderPlayers();
            nameInput.value = '';
            rankSelect.value = '9';
            nameInput.focus();
            document.getElementById('error').classList.remove('active');
        }

        function addFromBench(index) {
            const bp = bench[index];
            if (players.some(p => p.name.toLowerCase() === bp.name.toLowerCase())) {
                showError('This player is already active!'); return;
            }
            players.push({ name: bp.name, rank: bp.rank, id: Date.now().toString() });
            savePlayers();
            renderPlayers();
            renderBench();
            document.getElementById('error').classList.remove('active');
        }

        function addSelectedToActive() {
            const checkboxes = document.querySelectorAll('.bench-checkbox:checked');
            if (checkboxes.length === 0) {
                showError('No players selected!'); return;
            }
            
            let added = 0;
            checkboxes.forEach(cb => {
                const idx = parseInt(cb.dataset.index);
                const bp = bench[idx];
                if (!players.some(p => p.name.toLowerCase() === bp.name.toLowerCase())) {
                    players.push({ name: bp.name, rank: bp.rank, id: Date.now().toString() + added });
                    added++;
                }
            });
            
            if (added > 0) {
                savePlayers();
                renderPlayers();
                renderBench();
            }
            document.getElementById('error').classList.remove('active');
        }

        function selectAllBench() {
            const checkboxes = document.querySelectorAll('.bench-checkbox');
            const allChecked = Array.from(checkboxes).every(cb => cb.checked);
            checkboxes.forEach(cb => cb.checked = !allChecked);
            updateSelectedCount();
        }

        function updateSelectedCount() {
            const count = document.querySelectorAll('.bench-checkbox:checked').length;
            document.getElementById('selectedCount').textContent = count > 0 ? `${count} selected` : '';
        }

        function updatePlayerRank(index, newRank, selectElement) {
            players[index].rank = parseInt(newRank);
            savePlayers();
            selectElement.className = 'rank-select-inline ' + CS2_RANKS[parseInt(newRank)].tier;
        }

        function deletePlayer(index) {
            if (confirm(`Remove ${players[index].name}?`)) {
                players.splice(index, 1);
                savePlayers();
                renderPlayers();
                renderBench();
            }
        }

        function clearAllPlayers() {
            if (players.length === 0) { showError('No active players!'); return; }
            if (confirm('Clear all active players?')) {
                players = [];
                savePlayers();
                renderPlayers();
                renderBench();
                document.getElementById('results').classList.remove('active');
                shuffleCount = 0;
                currentTeams = [];
            }
        }

        function addToBench() {
            const nameInput = document.getElementById('benchName');
            const name = nameInput.value.trim();
            if (!name) return;
            if (bench.some(b => b.name.toLowerCase() === name.toLowerCase())) {
                showError('Already on bench!'); return;
            }
            bench.push({ name, rank: 9, id: Date.now().toString() });
            saveBench();
            renderBench();
            nameInput.value = '';
            document.getElementById('error').classList.remove('active');
        }

        function updateBenchRank(index, newRank, selectElement) {
            bench[index].rank = parseInt(newRank);
            saveBench();
            selectElement.className = 'rank-select-inline ' + CS2_RANKS[parseInt(newRank)].tier;
        }

        function removeFromBench(index) {
            bench.splice(index, 1);
            saveBench();
            renderBench();
        }

        function generateRankOptions(selectedRank) {
            return Array.from({length: 18}, (_, i) => i + 1)
                .map(i => `<option value="${i}" ${i === selectedRank ? 'selected' : ''}>${CS2_RANKS[i].short}</option>`)
                .join('');
        }

        function renderPlayers() {
            const container = document.getElementById('playersContainer');
            document.getElementById('playerCount').textContent = players.length;

            if (players.length === 0) {
                container.innerHTML = '<div class="empty-state">No active players. Add from bench or manually.</div>';
                return;
            }

            const sorted = [...players].sort((a, b) => b.rank - a.rank);
            container.innerHTML = sorted.map(player => {
                const idx = players.findIndex(p => p.name === player.name);
                const rd = CS2_RANKS[player.rank];
                return `
                    <div class="player-card">
                        <div class="player-info">
                            <span class="player-name">${player.name}</span>
                            <select class="rank-select-inline ${rd.tier}" onchange="updatePlayerRank(${idx}, this.value, this)">
                                ${generateRankOptions(player.rank)}
                            </select>
                        </div>
                        <button class="btn-delete" onclick="deletePlayer(${idx})">‚úï</button>
                    </div>
                `;
            }).join('');
        }

        function renderBench() {
            const container = document.getElementById('benchList');

            if (bench.length === 0) {
                container.innerHTML = '<div class="empty-state">Bench is empty</div>';
                document.getElementById('selectedCount').textContent = '';
                return;
            }

            const sorted = [...bench].sort((a, b) => a.name.localeCompare(b.name));
            container.innerHTML = sorted.map(player => {
                const idx = bench.findIndex(b => b.name === player.name);
                const rd = CS2_RANKS[player.rank];
                const isActive = players.some(p => p.name.toLowerCase() === player.name.toLowerCase());
                return `
                    <div class="bench-item">
                        <input type="checkbox" class="bench-checkbox" data-index="${idx}" onchange="updateSelectedCount()" ${isActive ? 'disabled' : ''}>
                        <div class="bench-item-info">
                            <span class="bench-item-name" ${isActive ? 'style="color:#3ba55c;"' : ''}>${player.name}</span>
                            <select class="rank-select-inline ${rd.tier}" onchange="updateBenchRank(${idx}, this.value, this)" style="font-size:10px;padding:2px 4px;">
                                ${generateRankOptions(player.rank)}
                            </select>
                        </div>
                        <div class="bench-item-actions">
                            <button class="btn-bench-remove" onclick="removeFromBench(${idx})">‚úï</button>
                        </div>
                    </div>
                `;
            }).join('');
            updateSelectedCount();
        }

        function createTeams() {
            document.getElementById('error').classList.remove('active');
            if (players.length === 0) { showError('Please add players first!'); return; }

            const teamCount = parseInt(document.getElementById('teamCount').value);
            if (teamCount < 2 || teamCount > players.length) {
                showError(`Teams must be between 2 and ${players.length}!`); return;
            }

            const ppt = parseInt(document.getElementById('playersPerTeam').value);
            if (ppt > 0 && ppt * teamCount > players.length) {
                showError(`Need ${ppt * teamCount} players but only ${players.length} available!`); return;
            }

            shuffleCount++;
            selectedForSwap = null;
            currentTeams = balanceTeams(players, teamCount, ppt, shuffleCount);
            displayTeams();
        }

        function balanceTeams(playerList, teamCount, playersPerTeam, iteration) {
            let sorted = [...playerList].sort((a, b) => b.rank - a.rank);
            const total = playersPerTeam > 0 ? playersPerTeam * teamCount : playerList.length;
            let toUse = sorted.slice(0, total);

            if (iteration > 1) {
                for (let i = 0; i < toUse.length - 1; i++) {
                    if (Math.abs(toUse[i].rank - toUse[i + 1].rank) <= 2 && Math.random() < 0.4) {
                        [toUse[i], toUse[i + 1]] = [toUse[i + 1], toUse[i]];
                    }
                }
            }

            const teams = Array.from({ length: teamCount }, () => ({ players: [], totalPower: 0 }));
            toUse.forEach((player, index) => {
                const round = Math.floor(index / teamCount);
                const pos = index % teamCount;
                const teamIdx = round % 2 === 0 ? pos : teamCount - 1 - pos;
                teams[teamIdx].players.push({...player});
                teams[teamIdx].totalPower += player.rank;
            });

            return teams;
        }

        function selectPlayerForSwap(teamIndex, playerIndex) {
            if (selectedForSwap === null) {
                selectedForSwap = { teamIndex, playerIndex };
                displayTeams();
                document.getElementById('swapInfo').textContent = `Selected: ${currentTeams[teamIndex].players[playerIndex].name} - Click another player to swap`;
                document.getElementById('swapInfo').classList.add('active');
            } else {
                if (selectedForSwap.teamIndex === teamIndex && selectedForSwap.playerIndex === playerIndex) {
                    selectedForSwap = null;
                    displayTeams();
                    document.getElementById('swapInfo').textContent = 'Click a player to select, then click another to swap';
                    document.getElementById('swapInfo').classList.remove('active');
                    return;
                }

                // Perform swap
                const team1 = currentTeams[selectedForSwap.teamIndex];
                const team2 = currentTeams[teamIndex];
                const player1 = team1.players[selectedForSwap.playerIndex];
                const player2 = team2.players[playerIndex];

                team1.players[selectedForSwap.playerIndex] = player2;
                team2.players[playerIndex] = player1;

                // Recalculate powers
                team1.totalPower = team1.players.reduce((sum, p) => sum + p.rank, 0);
                team2.totalPower = team2.players.reduce((sum, p) => sum + p.rank, 0);

                selectedForSwap = null;
                displayTeams();
                document.getElementById('swapInfo').textContent = 'Swapped! Click players to swap more';
                document.getElementById('swapInfo').classList.remove('active');
            }
        }

        function displayTeams() {
            const container = document.getElementById('teamsContainer');
            container.innerHTML = '';

            const names = ['Terrorists', 'Counter-Terrorists'];
            const classes = ['terrorists', 'counter-terrorists'];

            currentTeams.forEach((team, ti) => {
                const div = document.createElement('div');
                div.className = `team ${classes[ti % 2]}`;
                
                const avgRank = team.players.length > 0 ? Math.round(team.totalPower / team.players.length) : 0;
                const avgName = CS2_RANKS[avgRank] ? CS2_RANKS[avgRank].short : '-';
                
                div.innerHTML = `
                    <h2>
                        <span>${names[ti % 2]} (${team.players.length})</span>
                        <span class="team-power">Avg: ${avgName}</span>
                    </h2>
                    <ul>
                        ${team.players.map((p, pi) => {
                            const rd = CS2_RANKS[p.rank];
                            const isSelected = selectedForSwap && selectedForSwap.teamIndex === ti && selectedForSwap.playerIndex === pi;
                            return `<li class="${isSelected ? 'selected-for-swap' : ''}" onclick="selectPlayerForSwap(${ti}, ${pi})">
                                <span class="player-number">${pi + 1}</span>
                                <span>${p.name}</span>
                                <span class="rank-badge ${rd.tier}" style="margin-left:auto;">${rd.short}</span>
                            </li>`;
                        }).join('')}
                    </ul>
                `;
                container.appendChild(div);
            });

            document.getElementById('results').classList.add('active');
            setTimeout(() => document.getElementById('results').scrollIntoView({ behavior: 'smooth', block: 'nearest' }), 100);
        }

        function showError(msg) {
            const err = document.getElementById('error');
            err.textContent = '‚ö†Ô∏è ' + msg;
            err.classList.add('active');
        }

        function copyResults() {
            let text = 'üèÜ 1EGIT GAMING - BALANCED TEAMS üèÜ\n\n';
            const names = ['Terrorists', 'Counter-Terrorists'];
            
            currentTeams.forEach((team, i) => {
                const avgRank = team.players.length > 0 ? Math.round(team.totalPower / team.players.length) : 0;
                text += `${names[i % 2]} (${team.players.length}) - Avg: ${CS2_RANKS[avgRank]?.short || '-'}\n`;
                team.players.forEach((p, j) => {
                    text += `  ${j + 1}. ${p.name} [${CS2_RANKS[p.rank].short}]\n`;
                });
                text += '\n';
            });

            navigator.clipboard.writeText(text).then(() => {
                const btn = event.target;
                btn.textContent = '‚úÖ Copied!';
                setTimeout(() => btn.textContent = 'üìã Copy Results', 2000);
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('playerName').addEventListener('keypress', e => { if (e.key === 'Enter') addPlayer(); });
            document.getElementById('benchName').addEventListener('keypress', e => { if (e.key === 'Enter') addToBench(); });
        });
    </script>
</body>
</html>
