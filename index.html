<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1EGIT Gaming - Team Creator</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script> 
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script> 
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --discord-dark: #1e1f22;
            --discord-darker: #111214;
            --discord-not-quite-black: #2b2d31;
            --discord-gray: #313338;
            --discord-light-gray: #383a40;
            --discord-lighter-gray: #404249;
            --discord-text: #dbdee1;
            --discord-text-muted: #949ba4;
            --discord-text-faint: #6d6f78;
            --discord-blurple: #5865f2;
            --discord-blurple-hover: #4752c4;
            --discord-green: #23a55a;
            --discord-yellow: #f0b232;
            --discord-red: #da373c;
            --discord-white: #ffffff;
        }
        body {
            font-family: 'gg sans', 'Noto Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background-color: var(--discord-gray) !important;
            min-height: 100vh;
            padding: 20px;
            color: var(--discord-text);
        }
        .page-wrapper {
            display: flex !important;
            flex-direction: row !important;
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
            align-items: flex-start;
        }
        .main-container {
            flex: 1 1 auto;
            min-width: 0;
            max-width: calc(100% - 320px);
        }
        .container {
            background: var(--discord-not-quite-black) !important;
            border-radius: 8px;
            padding: 32px;
            position: relative;
        }
        .server-info {
            position: absolute;
            top: 16px;
            right: 16px;
            text-align: right;
            font-family: 'Consolas', monospace;
        }
        .server-info .connect { color: var(--discord-green); font-size: 13px; font-weight: 600; }
        .server-info .password { color: var(--discord-yellow); font-size: 12px; margin-top: 2px; }
        .header { text-align: center; margin-bottom: 24px; }
        .logo { width: 140px; height: auto; margin-bottom: 12px; }
        h1 { text-align: center; color: var(--discord-white); margin-bottom: 8px; font-size: 1.8em; font-weight: 600; }
        .input-section { background: var(--discord-dark) !important; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--discord-text-muted); font-size: 12px; text-transform: uppercase; }
        .add-player-form { display: flex; gap: 12px; margin-bottom: 16px; flex-wrap: wrap; align-items: flex-end; }
        .form-group { display: flex; flex-direction: column; gap: 6px; }
        .form-group.name-group { flex: 2; min-width: 180px; }
        .form-group.rank-group { flex: 1.5; min-width: 200px; }
        .form-group label { font-size: 12px; margin-bottom: 0; }
        input[type="text"] { padding: 10px 12px; border: none; border-radius: 4px; font-size: 16px; background: var(--discord-darker); color: var(--discord-text); }
        input[type="text"]:focus { outline: none; box-shadow: 0 0 0 2px var(--discord-blurple); }
        input[type="text"]::placeholder { color: var(--discord-text-faint); }
        .rank-select-wrapper { display: flex; align-items: center; background: var(--discord-darker); border-radius: 4px; padding-left: 8px; }
        .rank-select-wrapper .rank-icon { width: 32px; height: 32px; }
        .rank-select-wrapper select { flex: 1; padding: 10px 8px; border: none; background: transparent; color: var(--discord-text); cursor: pointer; font-size: 14px; }
        select { padding: 10px 12px; border: none; border-radius: 4px; font-size: 14px; background: var(--discord-darker); color: var(--discord-text); cursor: pointer; }
        select:focus { outline: none; box-shadow: 0 0 0 2px var(--discord-blurple); }
        .btn-add { padding: 10px 20px; background: var(--discord-blurple) !important; color: white !important; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; font-weight: 500; height: 42px; }
        .btn-add:hover { background: var(--discord-blurple-hover) !important; }
        .players-list { margin-top: 20px; margin-bottom: 16px; }
        .players-list h3 { color: var(--discord-white); margin-bottom: 12px; font-size: 1em; font-weight: 600; }
        #playersContainer { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 8px; max-height: 350px; overflow-y: auto; padding: 8px; background: var(--discord-darker); border-radius: 4px; }
        #playersContainer::-webkit-scrollbar { width: 8px; }
        #playersContainer::-webkit-scrollbar-track { background: var(--discord-darker); }
        #playersContainer::-webkit-scrollbar-thumb { background: var(--discord-lighter-gray); border-radius: 4px; }
        .player-card { background: var(--discord-light-gray); padding: 10px 12px; border-radius: 4px; display: flex; align-items: center; gap: 10px; }
        .player-card:hover { background: var(--discord-lighter-gray); }
        .player-info { display: flex; align-items: center; gap: 10px; flex: 1; min-width: 0; }
        .player-name { color: var(--discord-text); font-weight: 500; font-size: 14px; flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .player-actions { display: flex; align-items: center; gap: 8px; flex-shrink: 0; }
        .rank-icon { width: 28px; height: 28px; }
        .rank-icon-small { width: 22px; height: 22px; }
        .rank-select-inline { padding: 4px 8px; border: none; border-radius: 4px; font-size: 11px; font-weight: 600; background: var(--discord-darker); color: var(--discord-text); cursor: pointer; }
        .rank-select-inline:focus { outline: none; box-shadow: 0 0 0 2px var(--discord-blurple); }
        .rank-badge { padding: 4px 10px; border-radius: 4px; font-size: 11px; font-weight: 600; background: var(--discord-lighter-gray); color: var(--discord-text); }
        .btn-delete { background: transparent; border: none; color: var(--discord-red); cursor: pointer; font-size: 16px; padding: 4px; width: 28px; height: 28px; border-radius: 4px; display: flex; align-items: center; justify-content: center; }
        .btn-delete:hover { background: rgba(218, 55, 60, 0.1); }
        .empty-state { text-align: center; padding: 32px; color: var(--discord-text-faint); font-size: 14px; }
        .settings { display: flex; gap: 16px; margin-top: 16px; flex-wrap: wrap; }
        .setting-group { flex: 1; min-width: 180px; }
        input[type="number"] { width: 100%; padding: 10px 12px; border: none; border-radius: 4px; font-size: 16px; background: var(--discord-darker); color: var(--discord-text); }
        input[type="number"]:focus { outline: none; box-shadow: 0 0 0 2px var(--discord-blurple); }
        .button-group { display: flex; gap: 12px; margin-top: 20px; flex-wrap: wrap; }
        button { flex: 1; padding: 12px 24px; font-size: 14px; font-weight: 500; border: none; border-radius: 4px; cursor: pointer; min-width: 140px; }
        .btn-primary { background: var(--discord-blurple) !important; color: white !important; }
        .btn-primary:hover { background: var(--discord-blurple-hover) !important; }
        .btn-secondary { background: transparent !important; color: var(--discord-red) !important; border: 1px solid var(--discord-red) !important; }
        .btn-secondary:hover { background: rgba(218, 55, 60, 0.1) !important; }
        .results { margin-top: 24px; display: none; }
        .results.active { display: block; }
        .results > h2 { color: var(--discord-white); margin-bottom: 16px; font-size: 1.1em; font-weight: 600; }
        .teams-wrapper { display: flex; gap: 16px; flex-wrap: wrap; }
        .team { flex: 1; min-width: 280px; background: var(--discord-dark); padding: 16px; border-radius: 8px; }
        .team.terrorists { border-left: 4px solid var(--discord-yellow); }
        .team.counter-terrorists { border-left: 4px solid var(--discord-blurple); }
        .team h2 { color: var(--discord-white); margin-bottom: 12px; font-size: 1em; display: flex; justify-content: space-between; align-items: center; gap: 8px; }
        .team.terrorists h2 { color: var(--discord-yellow); }
        .team.counter-terrorists h2 { color: var(--discord-blurple); }
        .team-power { font-size: 0.85em; color: var(--discord-text-muted); background: var(--discord-darker); padding: 4px 12px; border-radius: 4px; }
        .team ul { list-style: none; }
        .team li { padding: 8px 12px; background: var(--discord-darker); margin-bottom: 6px; border-radius: 4px; display: flex; align-items: center; gap: 10px; font-size: 14px; color: var(--discord-text); cursor: pointer; }
        .team li:hover { background: var(--discord-light-gray); }
        .team li.selected-for-swap { background: var(--discord-blurple); box-shadow: 0 0 0 2px var(--discord-white); }
        .team li:last-child { margin-bottom: 0; }
        .player-number { color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 12px; }
        .team.terrorists .player-number { background: var(--discord-yellow); color: var(--discord-darker); }
        .team.counter-terrorists .player-number { background: var(--discord-blurple); }
        .swap-info { text-align: center; padding: 12px; background: var(--discord-darker); border-radius: 4px; margin-bottom: 16px; color: var(--discord-text-muted); font-size: 13px; }
        .swap-info.active { background: var(--discord-blurple); color: white; }
        .error { background: rgba(218, 55, 60, 0.1); border-left: 4px solid var(--discord-red); padding: 12px 16px; margin-top: 12px; border-radius: 4px; color: var(--discord-red); font-size: 14px; display: none; }
        .error.active { display: block; }
        .copy-btn { background: var(--discord-blurple) !important; color: white !important; padding: 10px 16px; margin-top: 12px; font-size: 14px; font-weight: 500; }
        .copy-btn:hover { background: var(--discord-blurple-hover) !important; }
        .bench-panel { width: 300px; flex-shrink: 0; background: var(--discord-not-quite-black); border-radius: 8px; padding: 16px; position: sticky; top: 20px; max-height: calc(100vh - 40px); display: flex; flex-direction: column; }
        .bench-panel h3 { color: var(--discord-white); margin-bottom: 16px; font-size: 1em; font-weight: 600; }
        .bench-add-form { display: flex; gap: 8px; margin-bottom: 12px; }
        .bench-add-form input { flex: 1; padding: 8px 12px; border: none; border-radius: 4px; font-size: 14px; background: var(--discord-darker); color: var(--discord-text); }
        .bench-add-form button { padding: 8px 12px; min-width: auto; flex: none; }
        .bench-actions { display: flex; gap: 8px; margin-bottom: 12px; }
        .bench-actions button { flex: 1; padding: 8px 12px; font-size: 12px; min-width: auto; }
        .btn-green { background: var(--discord-green) !important; color: white !important; border: none !important; }
        .btn-green:hover { filter: brightness(0.9); }
        .bench-list { flex: 1; overflow-y: auto; min-height: 200px; }
        .bench-list::-webkit-scrollbar { width: 6px; }
        .bench-list::-webkit-scrollbar-track { background: var(--discord-darker); }
        .bench-list::-webkit-scrollbar-thumb { background: var(--discord-lighter-gray); border-radius: 4px; }
        .bench-item { display: flex; align-items: center; padding: 6px 10px; background: var(--discord-dark); border-radius: 4px; margin-bottom: 4px; gap: 8px; }
        .bench-item:hover { background: var(--discord-light-gray); }
        .bench-checkbox { width: 18px; height: 18px; cursor: pointer; accent-color: var(--discord-blurple); }
        .bench-item-info { display: flex; align-items: center; gap: 6px; flex: 1; min-width: 0; }
        .bench-item-name { color: var(--discord-text); font-size: 13px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .bench-item-actions { display: flex; gap: 4px; flex-shrink: 0; }
        .btn-bench-remove { background: transparent; color: var(--discord-red); border: none; padding: 4px 6px; border-radius: 4px; cursor: pointer; font-size: 14px; min-width: auto; }
        .btn-bench-remove:hover { background: rgba(218, 55, 60, 0.1); }
        .shuffle-info { font-size: 11px; color: var(--discord-text-faint); margin-top: 8px; font-style: italic; }
        .selected-count { font-size: 12px; color: var(--discord-green); margin-bottom: 8px; }
        @media (max-width: 900px) {
            .page-wrapper { flex-direction: column; }
            .bench-panel { width: 100%; position: static; max-height: none; order: -1; }
            .main-container { max-width: 100%; }
            .bench-list { max-height: 250px; }
        }
        @media (max-width: 768px) {
            body { padding: 10px; }
            .container { padding: 16px; }
            h1 { font-size: 1.4em; }
            .logo { width: 100px; }
            .server-info { position: static; text-align: center; margin-bottom: 16px; }
            .server-info .connect { font-size: 12px; }
            .server-info .password { font-size: 11px; }
            .input-section { padding: 14px; }
            .add-player-form { flex-direction: column; gap: 10px; }
            .form-group.name-group, .form-group.rank-group { min-width: 100%; }
            .btn-add { width: 100%; height: 44px; }
            #playersContainer { grid-template-columns: 1fr; max-height: 280px; padding: 6px; gap: 6px; }
            .player-card { padding: 10px; }
            .player-name { font-size: 13px; }
            .rank-icon { width: 24px; height: 24px; }
            .rank-select-inline { font-size: 10px; padding: 4px 6px; }
            .btn-delete { width: 32px; height: 32px; font-size: 18px; }
            .settings { flex-direction: column; gap: 12px; }
            .setting-group { min-width: 100%; }
            .button-group { flex-direction: column; gap: 10px; }
            button { width: 100%; padding: 14px; font-size: 14px; min-width: auto; }
            .shuffle-info { font-size: 10px; text-align: center; }
            .teams-wrapper { flex-direction: column; gap: 12px; }
            .team { min-width: 100%; padding: 12px; }
            .team h2 { font-size: 0.9em; flex-wrap: wrap; }
            .team li { padding: 8px 10px; gap: 8px; font-size: 13px; }
            .player-number { width: 22px; height: 22px; font-size: 11px; }
            .rank-icon-small { width: 20px; height: 20px; }
            .rank-badge { padding: 3px 8px; font-size: 10px; }
            .swap-info { font-size: 12px; padding: 10px; }
            .copy-btn { width: 100%; padding: 14px; }
            .bench-panel { padding: 14px; margin-bottom: 10px; }
            .bench-panel h3 { font-size: 0.95em; margin-bottom: 12px; }
            .bench-add-form { gap: 6px; }
            .bench-add-form input { padding: 10px; font-size: 14px; }
            .bench-add-form button { padding: 10px 14px; height: auto; }
            .bench-actions { gap: 6px; }
            .bench-actions button { padding: 10px; font-size: 11px; }
            .bench-list { max-height: 200px; }
            .bench-item { padding: 8px; gap: 6px; }
            .bench-item-name { font-size: 12px; }
            .bench-checkbox { width: 20px; height: 20px; }
            .error { font-size: 13px; padding: 10px 12px; }
        }
        @media (max-width: 400px) {
            body { padding: 6px; }
            .container { padding: 12px; }
            h1 { font-size: 1.2em; }
            .logo { width: 80px; }
            .input-section { padding: 12px; }
            label { font-size: 11px; }
            .player-name { font-size: 12px; }
            .rank-icon { width: 22px; height: 22px; }
            .team li { padding: 6px 8px; }
        }
    </style>
</head>
<body>
    <div class="page-wrapper">
        <div class="main-container">
            <div class="container">
                <div class="server-info">
                    <div class="connect">Connect 95.173.175.173</div>
                    <div class="password">Password 3113</div>
                </div>
                <div class="header">
                    <img src="https://raw.githubusercontent.com/Oozanalp/Team-Creator/main/guncel_1egit%202.png" alt="1EGIT Gaming Logo" class="logo">
                    <h1>Team Creator</h1>
                </div>
                <div class="input-section">
                    <label>üéÆ Add New Player</label>
                    <div class="add-player-form">
                        <div class="form-group name-group">
                            <label for="playerName">Name</label>
                            <input type="text" id="playerName" placeholder="Player name...">
                        </div>
                        <div class="form-group rank-group">
                            <label for="playerRank">CS2 Rank</label>
                            <div class="rank-select-wrapper">
                                <img id="selectedRankIcon" class="rank-icon" src="https://cdn.jsdelivr.net/gh/ItzArty/csgo-rank-icons@main/ranks/9.png" alt="Rank">
                                <select id="playerRank" onchange="updateRankIcon()">
                                    <optgroup label="Silver"><option value="1">Silver I</option><option value="2">Silver II</option><option value="3">Silver III</option><option value="4">Silver IV</option><option value="5">Silver Elite</option><option value="6">Silver Elite Master</option></optgroup>
                                    <optgroup label="Gold Nova"><option value="7">Gold Nova I</option><option value="8">Gold Nova II</option><option value="9" selected>Gold Nova III</option><option value="10">Gold Nova Master</option></optgroup>
                                    <optgroup label="Master Guardian"><option value="11">Master Guardian I</option><option value="12">Master Guardian II</option><option value="13">Master Guardian Elite</option><option value="14">Distinguished Master Guardian</option></optgroup>
                                    <optgroup label="Elite"><option value="15">Legendary Eagle</option><option value="16">Legendary Eagle Master</option><option value="17">Supreme Master First Class</option><option value="18">Global Elite</option></optgroup>
                                </select>
                            </div>
                        </div>
                        <button class="btn-add" onclick="addPlayer()">+ Add</button>
                    </div>
                    <div class="players-list">
                        <h3>üìã Active Players (<span id="playerCount">0</span>)</h3>
                        <div id="playersContainer"></div>
                    </div>
                    <div class="settings">
                        <div class="setting-group"><label for="teamCount">Number of Teams</label><input type="number" id="teamCount" min="2" max="20" value="2"></div>
                        <div class="setting-group"><label for="playersPerTeam">Players per Team (0 = Auto)</label><input type="number" id="playersPerTeam" min="0" max="50" value="5"></div>
                    </div>
                    <div class="error" id="error"></div>
                    <div class="button-group">
                        <button class="btn-primary" onclick="createTeams()">üé≤ Create Balanced Teams</button>
                        <button class="btn-secondary" onclick="clearAllPlayers()">üóëÔ∏è Clear Active Players</button>
                    </div>
                    <div class="shuffle-info">üí° Press multiple times to shuffle. Click players in teams to swap them.</div>
                </div>
                <div class="results" id="results">
                    <h2>üìã Generated Teams</h2>
                    <div class="swap-info" id="swapInfo">Click a player to select, then click another to swap</div>
                    <div class="teams-wrapper" id="teamsContainer"></div>
                    <button class="copy-btn" onclick="copyResults()">üìã Copy Results</button>
                </div>
            </div>
        </div>
        <div class="bench-panel">
            <h3>ü™ë Bench</h3>
            <div class="bench-add-form"><input type="text" id="benchName" placeholder="Add to bench..."><button class="btn-add" onclick="addToBench()">+</button></div>
            <div class="bench-actions"><button class="btn-green" onclick="addSelectedToActive()">Add Selected</button><button class="btn-secondary" onclick="selectAllBench()">Select All</button></div>
            <div class="selected-count" id="selectedCount"></div>
            <div class="bench-list" id="benchList"></div>
        </div>
    </div>
    <script>
        const RANK_ICONS = {1:'https://cdn.jsdelivr.net/gh/ItzArty/csgo-rank-icons@main/ranks/1.png',2:'https://cdn.jsdelivr.net/gh/ItzArty/csgo-rank-icons@main/ranks/2.png',3:'https://cdn.jsdelivr.net/gh/ItzArty/csgo-rank-icons@main/ranks/3.png',4:'https://cdn.jsdelivr.net/gh/ItzArty/csgo-rank-icons@main/ranks/4.png',5:'https://cdn.jsdelivr.net/gh/ItzArty/csgo-rank-icons@main/ranks/5.png',6:'https://cdn.jsdelivr.net/gh/ItzArty/csgo-rank-icons@main/ranks/6.png',7:'https://cdn.jsdelivr.net/gh/ItzArty/csgo-rank-icons@main/ranks/7.png',8:'https://cdn.jsdelivr.net/gh/ItzArty/csgo-rank-icons@main/ranks/8.png',9:'https://cdn.jsdelivr.net/gh/ItzArty/csgo-rank-icons@main/ranks/9.png',10:'https://cdn.jsdelivr.net/gh/ItzArty/csgo-rank-icons@main/ranks/10.png',11:'https://cdn.jsdelivr.net/gh/ItzArty/csgo-rank-icons@main/ranks/11.png',12:'https://cdn.jsdelivr.net/gh/ItzArty/csgo-rank-icons@main/ranks/12.png',13:'https://cdn.jsdelivr.net/gh/ItzArty/csgo-rank-icons@main/ranks/13.png',14:'https://cdn.jsdelivr.net/gh/ItzArty/csgo-rank-icons@main/ranks/14.png',15:'https://cdn.jsdelivr.net/gh/ItzArty/csgo-rank-icons@main/ranks/15.png',16:'https://cdn.jsdelivr.net/gh/ItzArty/csgo-rank-icons@main/ranks/16.png',17:'https://cdn.jsdelivr.net/gh/ItzArty/csgo-rank-icons@main/ranks/17.png',18:'https://cdn.jsdelivr.net/gh/ItzArty/csgo-rank-icons@main/ranks/18.png'};
        const CS2_RANKS = {1:{name:'Silver I',short:'S1'},2:{name:'Silver II',short:'S2'},3:{name:'Silver III',short:'S3'},4:{name:'Silver IV',short:'S4'},5:{name:'Silver Elite',short:'SE'},6:{name:'Silver Elite Master',short:'SEM'},7:{name:'Gold Nova I',short:'GN1'},8:{name:'Gold Nova II',short:'GN2'},9:{name:'Gold Nova III',short:'GN3'},10:{name:'Gold Nova Master',short:'GNM'},11:{name:'Master Guardian I',short:'MG1'},12:{name:'Master Guardian II',short:'MG2'},13:{name:'Master Guardian Elite',short:'MGE'},14:{name:'Distinguished Master Guardian',short:'DMG'},15:{name:'Legendary Eagle',short:'LE'},16:{name:'Legendary Eagle Master',short:'LEM'},17:{name:'Supreme Master First Class',short:'SMFC'},18:{name:'Global Elite',short:'GE'}};
        const firebaseConfig = {apiKey:"AIzaSyC_BDlbY-uyUOKguX9q0NvgMMaNlpJEvRU",authDomain:"legit---team-creator.firebaseapp.com",databaseURL:"https://legit---team-creator-default-rtdb.europe-west1.firebasedatabase.app",projectId:"legit---team-creator",storageBucket:"legit---team-creator.firebasestorage.app",messagingSenderId:"475101153038",appId:"1:475101153038:web:a6a464384178890d60f95f"};
        const useFirebase = true;
        let db = null;
        if (useFirebase && typeof firebase !== 'undefined') { try { firebase.initializeApp(firebaseConfig); db = firebase.database(); } catch (e) { console.log('Firebase error:', e); } }
        let players = [], bench = [], currentTeams = [], shuffleCount = 0, selectedForSwap = null;
        window.onload = () => loadData();
        function updateRankIcon() { document.getElementById('selectedRankIcon').src = RANK_ICONS[parseInt(document.getElementById('playerRank').value)]; }
        function loadData() {
            if (useFirebase && db) {
                db.ref('players').on('value', s => { players = []; s.forEach(c => players.push({id: c.key, ...c.val()})); renderPlayers(); });
                db.ref('bench').on('value', s => { bench = []; s.forEach(c => bench.push({id: c.key, ...c.val()})); renderBench(); });
            } else { players = JSON.parse(localStorage.getItem('players_1egit')) || []; bench = JSON.parse(localStorage.getItem('bench_1egit')) || []; renderPlayers(); renderBench(); }
        }
        function savePlayers() { if (useFirebase && db) { const o = {}; players.forEach((p,i) => o[p.id||i] = {name:p.name,rank:p.rank}); db.ref('players').set(o); } else localStorage.setItem('players_1egit', JSON.stringify(players)); }
        function saveBench() { if (useFirebase && db) { const o = {}; bench.forEach((b,i) => o[b.id||i] = {name:b.name,rank:b.rank}); db.ref('bench').set(o); } else localStorage.setItem('bench_1egit', JSON.stringify(bench)); }
        function addPlayer() {
            const name = document.getElementById('playerName').value.trim();
            const rank = parseInt(document.getElementById('playerRank').value);
            if (!name) { showError('Please enter a player name!'); return; }
            if (players.some(p => p.name.toLowerCase() === name.toLowerCase())) { showError('Already active!'); return; }
            const newId = Date.now().toString() + Math.random().toString(36).substr(2, 9);
            if (useFirebase && db) {
                db.ref('players/' + newId).set({name: name, rank: rank});
            } else {
                players.push({name, rank, id: newId});
                savePlayers();
                renderPlayers();
            }
            document.getElementById('playerName').value = '';
            document.getElementById('playerRank').value = '9';
            updateRankIcon();
            document.getElementById('error').classList.remove('active');
        }
        function addFromBench(i) {
            const bp = bench[i];
            if (players.some(p => p.name.toLowerCase() === bp.name.toLowerCase())) { showError('Already active!'); return; }
            players.push({name: bp.name, rank: bp.rank, id: Date.now().toString()}); savePlayers(); renderPlayers(); renderBench();
            document.getElementById('error').classList.remove('active');
        }
        function addSelectedToActive() {
            const cbs = document.querySelectorAll('.bench-checkbox:checked');
            if (!cbs.length) { showError('No players selected!'); return; }
            let added = 0;
            cbs.forEach(cb => { const bp = bench[parseInt(cb.dataset.index)]; if (!players.some(p => p.name.toLowerCase() === bp.name.toLowerCase())) { players.push({name: bp.name, rank: bp.rank, id: Date.now().toString() + added++}); } });
            if (added) { savePlayers(); renderPlayers(); renderBench(); }
            document.getElementById('error').classList.remove('active');
        }
        function selectAllBench() { const cbs = document.querySelectorAll('.bench-checkbox'); const all = Array.from(cbs).every(c => c.checked); cbs.forEach(c => c.checked = !all); updateSelectedCount(); }
        function updateSelectedCount() { const n = document.querySelectorAll('.bench-checkbox:checked').length; document.getElementById('selectedCount').textContent = n ? `${n} selected` : ''; }
        function updatePlayerRank(i, r) { players[i].rank = parseInt(r); savePlayers(); renderPlayers(); }
        function deletePlayer(i) { if (confirm(`Remove ${players[i].name}?`)) { players.splice(i,1); savePlayers(); renderPlayers(); renderBench(); } }
        function clearAllPlayers() { if (!players.length) { showError('No active players!'); return; } if (confirm('Clear all?')) { players = []; savePlayers(); renderPlayers(); renderBench(); document.getElementById('results').classList.remove('active'); shuffleCount = 0; currentTeams = []; } }
        function addToBench() {
            const name = document.getElementById('benchName').value.trim();
            if (!name) return;
            if (bench.some(b => b.name.toLowerCase() === name.toLowerCase())) { showError('Already on bench!'); return; }
            const newId = Date.now().toString() + Math.random().toString(36).substr(2, 9);
            if (useFirebase && db) {
                db.ref('bench/' + newId).set({name: name, rank: 9});
            } else {
                bench.push({name, rank: 9, id: newId});
                saveBench();
                renderBench();
            }
            document.getElementById('benchName').value = '';
            document.getElementById('error').classList.remove('active');
        }
        function updateBenchRank(i, r) { bench[i].rank = parseInt(r); saveBench(); renderBench(); }
        function removeFromBench(i) { bench.splice(i,1); saveBench(); renderBench(); }
        function generateRankOptions(sel) { return Array.from({length:18},(_,i)=>i+1).map(i=>`<option value="${i}" ${i===sel?'selected':''}>${CS2_RANKS[i].short}</option>`).join(''); }
        function renderPlayers() {
            const c = document.getElementById('playersContainer');
            document.getElementById('playerCount').textContent = players.length;
            if (!players.length) { c.innerHTML = '<div class="empty-state">No active players</div>'; return; }
            c.innerHTML = [...players].sort((a,b)=>b.rank-a.rank).map(p => {
                const i = players.findIndex(x=>x.name===p.name);
                return `<div class="player-card">
                    <div class="player-info">
                        <span class="player-name">${p.name}</span>
                    </div>
                    <div class="player-actions">
                        <img src="${RANK_ICONS[p.rank]}" class="rank-icon" alt="${CS2_RANKS[p.rank].name}">
                        <select class="rank-select-inline" onchange="updatePlayerRank(${i},this.value)">${generateRankOptions(p.rank)}</select>
                        <button class="btn-delete" onclick="deletePlayer(${i})">‚úï</button>
                    </div>
                </div>`;
            }).join('');
        }
        function renderBench() {
            const c = document.getElementById('benchList');
            if (!bench.length) { c.innerHTML = '<div class="empty-state">Bench is empty</div>'; document.getElementById('selectedCount').textContent = ''; return; }
            c.innerHTML = [...bench].sort((a,b)=>a.name.localeCompare(b.name)).map(p => {
                const i = bench.findIndex(x=>x.name===p.name);
                const active = players.some(x=>x.name.toLowerCase()===p.name.toLowerCase());
                return `<div class="bench-item"><input type="checkbox" class="bench-checkbox" data-index="${i}" onchange="updateSelectedCount()" ${active?'disabled':''}><div class="bench-item-info"><img src="${RANK_ICONS[p.rank]}" class="rank-icon-small" alt="${CS2_RANKS[p.rank].name}"><span class="bench-item-name" ${active?'style="color:var(--discord-green);"':''}>${p.name}</span></div><div class="bench-item-actions"><select class="rank-select-inline" onchange="updateBenchRank(${i},this.value)" style="font-size:10px;padding:2px 4px;width:55px;">${generateRankOptions(p.rank)}</select><button class="btn-bench-remove" onclick="removeFromBench(${i})">‚úï</button></div></div>`;
            }).join('');
            updateSelectedCount();
        }
        function createTeams() {
            document.getElementById('error').classList.remove('active');
            if (!players.length) { showError('Add players first!'); return; }
            const tc = parseInt(document.getElementById('teamCount').value);
            if (tc < 2 || tc > players.length) { showError(`Teams: 2-${players.length}`); return; }
            const ppt = parseInt(document.getElementById('playersPerTeam').value);
            if (ppt > 0 && ppt * tc > players.length) { showError(`Need ${ppt*tc} players, have ${players.length}`); return; }
            shuffleCount++; selectedForSwap = null;
            currentTeams = balanceTeams(players, tc, ppt, shuffleCount);
            displayTeams();
        }
        function balanceTeams(list, tc, ppt, iter) {
            let sorted = [...list].sort((a,b) => b.rank - a.rank);
            const total = ppt > 0 ? ppt * tc : list.length;
            let use = sorted.slice(0, total);
            if (iter > 1) { for (let i = 0; i < use.length - 1; i++) { if (Math.abs(use[i].rank - use[i+1].rank) <= 2 && Math.random() < 0.4) { [use[i], use[i+1]] = [use[i+1], use[i]]; } } }
            const teams = Array.from({length: tc}, () => ({players: [], totalPower: 0}));
            use.forEach((p, idx) => { const round = Math.floor(idx / tc); const pos = idx % tc; const ti = round % 2 === 0 ? pos : tc - 1 - pos; teams[ti].players.push({...p}); teams[ti].totalPower += p.rank; });
            return teams;
        }
        function selectPlayerForSwap(ti, pi) {
            if (!selectedForSwap) { selectedForSwap = {teamIndex: ti, playerIndex: pi}; displayTeams(); document.getElementById('swapInfo').textContent = `Selected: ${currentTeams[ti].players[pi].name} - Click another to swap`; document.getElementById('swapInfo').classList.add('active'); }
            else {
                if (selectedForSwap.teamIndex === ti && selectedForSwap.playerIndex === pi) { selectedForSwap = null; displayTeams(); document.getElementById('swapInfo').textContent = 'Click a player to select, then click another to swap'; document.getElementById('swapInfo').classList.remove('active'); return; }
                const t1 = currentTeams[selectedForSwap.teamIndex], t2 = currentTeams[ti];
                const p1 = t1.players[selectedForSwap.playerIndex], p2 = t2.players[pi];
                t1.players[selectedForSwap.playerIndex] = p2; t2.players[pi] = p1;
                t1.totalPower = t1.players.reduce((s,p) => s + p.rank, 0); t2.totalPower = t2.players.reduce((s,p) => s + p.rank, 0);
                selectedForSwap = null; displayTeams(); document.getElementById('swapInfo').textContent = 'Swapped! Click to swap more'; document.getElementById('swapInfo').classList.remove('active');
            }
        }
        function displayTeams() {
            const c = document.getElementById('teamsContainer'); c.innerHTML = '';
            const names = ['Terrorists', 'Counter-Terrorists'], classes = ['terrorists', 'counter-terrorists'];
            currentTeams.forEach((team, ti) => {
                const div = document.createElement('div'); div.className = `team ${classes[ti % 2]}`;
                const avg = team.players.length ? Math.round(team.totalPower / team.players.length) : 0;
                div.innerHTML = `<h2><span>${names[ti%2]} (${team.players.length})</span><span class="team-power">Avg: ${CS2_RANKS[avg]?.short || '-'}</span></h2><ul>${team.players.map((p,pi) => {
                    const sel = selectedForSwap && selectedForSwap.teamIndex === ti && selectedForSwap.playerIndex === pi;
                    return `<li class="${sel?'selected-for-swap':''}" onclick="selectPlayerForSwap(${ti},${pi})"><span class="player-number">${pi+1}</span><img src="${RANK_ICONS[p.rank]}" class="rank-icon-small" alt="${CS2_RANKS[p.rank].name}"><span>${p.name}</span><span class="rank-badge" style="margin-left:auto;">${CS2_RANKS[p.rank].short}</span></li>`;
                }).join('')}</ul>`;
                c.appendChild(div);
            });
            document.getElementById('results').classList.add('active');
            setTimeout(() => document.getElementById('results').scrollIntoView({behavior:'smooth',block:'nearest'}), 100);
        }
        function showError(msg) { const e = document.getElementById('error'); e.textContent = '‚ö†Ô∏è ' + msg; e.classList.add('active'); }
        function copyResults() {
            let text = 'üèÜ 1EGIT GAMING - BALANCED TEAMS üèÜ\n\n';
            const names = ['Terrorists', 'Counter-Terrorists'];
            currentTeams.forEach((team, i) => {
                const avg = team.players.length ? Math.round(team.totalPower / team.players.length) : 0;
                text += `${names[i%2]} (${team.players.length}) - Avg: ${CS2_RANKS[avg]?.short || '-'}\n`;
                team.players.forEach((p, j) => text += `  ${j+1}. ${p.name} [${CS2_RANKS[p.rank].short}]\n`);
                text += '\n';
            });
            navigator.clipboard.writeText(text).then(() => { const btn = event.target; btn.textContent = '‚úÖ Copied!'; setTimeout(() => btn.textContent = 'üìã Copy Results', 2000); });
        }
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('playerName').addEventListener('keypress', e => { if (e.key === 'Enter') addPlayer(); });
            document.getElementById('benchName').addEventListener('keypress', e => { if (e.key === 'Enter') addToBench(); });
        });
    </script>
</body>
</html>
